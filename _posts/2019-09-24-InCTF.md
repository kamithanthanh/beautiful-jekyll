---
layout : post 
title : InCTF 2019  
---  

# Má»Ÿ Ä‘áº§u  
Giáº£i nÃ y mÃ¬nh chÆ°a cÃ³ thá»i gian lÃ m crypto nhiá»u láº¯m. NhÆ°ng cÅ©ng lÃ m Ä‘Æ°á»£c 2 bÃ i re. NÃ³i chung lÃ  cÅ©ng khÃ¡ á»•n.  

# Table of Content  
 - [**[Crypto] LSB oracle attack**](#wu1)    
 - [**[Reverse] Cliche_clickme**](#wu2)  
 - [**[Reverse] Tic Tac Toe**](#wu3)  

<a name="wu1">  
</a>  

# [Crypto] LSB oracle attack 
BÃ i nÃ y lÃ  má»™t bÃ i RSA thuá»™c dáº¡ng [LSB oracle](https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack). Sad lÃ  theo cÃ¡ch giáº£i thÃ´ng thÆ°á»ng thÃ¬ cáº§n n cá»‘ Ä‘á»‹nh. Tháº¿ nÃªn bÃ i nÃ y mÃ¬nh báº¿ táº¯c luÃ´n.  
Sau khi náº±m vÃ¹ng vÃ  biáº¿t Ä‘Æ°á»£c writeup cá»§a tÃ¡c giáº£ [Ä‘Ã¢y](https://github.com/ashutosh1206/Crypton/tree/master/RSA-encryption/Attack-LSBit-Oracle-variant). ThÃ¬ cÅ©ng ngá»™ ra lÃ  Ä‘Ãºng lÃ  cÃ³ cÃ¡ch Ä‘á»ƒ giáº£i LSB oracle mÃ  khÃ´ng cáº§n n khÃ´ng Ä‘á»•i.  
**Ã tÆ°á»Ÿng** : Extract tá»«ng bit cá»§a plaintext tá»« bit nhá» nháº¥t báº±ng cÃ¡ch má»—i láº§n láº¡i decrypt m/2^i.  

Ã tÆ°á»Ÿng khÃ¡ lÃ  giá»‘ng vá»›i cÃ¡ch thÃ´ng thÆ°á»ng nhÆ°ng nÃ³ cÅ©ng khÃ¡ lÃ  khÃ¡c. ÄÆ¡n giáº£n mÃ  khÃ´ng nghÄ© ra. CÆ¡ báº£n lÃ  mÃ¬nh quÃ¡ lá»‡ thuá»™c vÃ o cÃ¡ch giáº£i cÅ© mÃ  lÆ°á»i suy nghÄ© cÃ¡ch giáº£i má»›i. Äi theo lá»—i mÃ²n tháº¿ lÃ  rÆ¡i vÃ o Ä‘Æ°á»ng cá»¥t.  ğŸ˜­ğŸ˜­ğŸ˜­   


<a name="wu2">  
</a> 
# [Reverse] Cliche_clickme  
ÄÃ¢y lÃ  má»™t file Mach-O nhÆ°ng reverse khÃ´ng khÃ¡c gÃ¬ má»™t file ELF thÃ´ng thÆ°á»ng. Sau khi reverse vÃ  Ä‘á»•i tÃªn thÃ¬ ta cÃ³ Ä‘Æ°á»£c file readable.  

![](/re/ctf/InCTF/cliche/hinh1.PNG)  

![](/re/ctf/InCTF/cliche/hinh2.PNG)   

Ta tháº¥y trong hÃ m ```main_``` cÃ³ hÃ m in ra chá»¯ ```Congratz``` tá»©c lÃ  input cá»§a chÃºng ta lÃ  Ä‘Ãºng.  
ÄÃ¢y thuá»™c dáº¡ng bÃ i keygen. Tá»©c lÃ  tÃ¬m key Ä‘á»ƒ cho ra flag. ChÃºng ta cÃ³ cÃ¡c hÃ m check input lÃ  ```func1 -> func4```.  
Sau khi reverse cÃ¡c func Ä‘Ã³ thÃ¬ mÃ¬nh chá»‘t láº¡i lÃ  chá»‰ cáº§n quan tÃ¢m Ä‘áº¿n func2.  

![](/re/ctf/InCTF/cliche/hinh3.PNG)  

Do á»Ÿ Ä‘Ã¢y sau khi setup ```heap``` trong func1 tá»« ```input``` ban Ä‘áº§u thÃ¬ nÃ³ so sÃ¡nh vá»›i giÃ¡ trá»‹ Ä‘Æ°á»£c lÆ°u trong binary.  
Sau khi reverse ```func3``` cÃ³ thá»ƒ Ä‘Æ°a ra káº¿t luáº­n ```input``` lÃ  chuá»—i kÃ­ tá»± cÃ³ Ä‘á»™ dÃ i 37. MÃ  tá»« ```func2``` chÃºng ta cÃ³ 666 phÆ°Æ¡ng trÃ¬nh mÃ  chá»‰ cÃ³ 37 áº©n nÃªn luÃ´n Ä‘á»§ Ä‘á»ƒ giáº£i ra nghiá»‡m.  

Tá»« Ä‘Ã¢y Ä‘Ã¡p vÃ o Z3 Ä‘á»ƒ giáº£i thÃ´i.  

```python
from z3 import * 
arr = [0xD7,0xCC,0xDD,0xCF,0xE4,0xBD,0xD1,0x9D,0xDD,0xDC,0xC8,0xD1,0xCE,0x9A,0x9A,0xC8,0xD5,0x99,0xDD,0xC8,0x99,0xCF,0xC8,0xE0,0x99,0xDB,0xD4,0xC8,0xE0,0x9D,0xDC,0xC8,0xD2,0xDD,0xA8,0xE6,0xD1,0xE2,0xD4,0xE9,0xC2,0xD6,0xA2,0xE2,0xE1,0xCD,0xD6,0xD3,0x9F,0x9F,0xCD,0xDA,0x9E,0xE2,0xCD,0x9E,0xD4,0xCD,0xE5,0x9E,0xE0,0xD9,0xCD,0xE5,0xA2,0xE1,0xCD,0xD7,0xE2,0xAD,0xEB,0xD7,0xC9,0xDE,0xB7,0xCB,0x97,0xD7,0xD6,0xC2,0xCB,0xC8,0x94,0x94,0xC2,0xCF,0x93,0xD7,0xC2,0x93,0xC9,0xC2,0xDA,0x93,0xD5,0xCE,0xC2,0xDA,0x97,0xD6,0xC2,0xCC,0xD7,0xA2,0xE0,0xDA,0xEF,0xC8,0xDC,0xA8,0xE8,0xE7,0xD3,0xDC,0xD9,0xA5,0xA5,0xD3,0xE0,0xA4,0xE8,0xD3,0xA4,0xDA,0xD3,0xEB,0xA4,0xE6,0xDF,0xD3,0xEB,0xA8,0xE7,0xD3,0xDD,0xE8,0xB3,0xF1,0xE1,0xBA,0xCE,0x9A,0xDA,0xD9,0xC5,0xCE,0xCB,0x97,0x97,0xC5,0xD2,0x96,0xDA,0xC5,0x96,0xCC,0xC5,0xDD,0x96,0xD8,0xD1,0xC5,0xDD,0x9A,0xD9,0xC5,0xCF,0xDA,0xA5,0xE3,0xCF,0xE3,0xAF,0xEF,0xEE,0xDA,0xE3,0xE0,0xAC,0xAC,0xDA,0xE7,0xAB,0xEF,0xDA,0xAB,0xE1,0xDA,0xF2,0xAB,0xED,0xE6,0xDA,0xF2,0xAF,0xEE,0xDA,0xE4,0xEF,0xBA,0xF8,0xBC,0x88,0xC8,0xC7,0xB3,0xBC,0xB9,0x85,0x85,0xB3,0xC0,0x84,0xC8,0xB3,0x84,0xBA,0xB3,0xCB,0x84,0xC6,0xBF,0xB3,0xCB,0x88,0xC7,0xB3,0xBD,0xC8,0x93,0xD1,0x9C,0xDC,0xDB,0xC7,0xD0,0xCD,0x99,0x99,0xC7,0xD4,0x98,0xDC,0xC7,0x98,0xCE,0xC7,0xDF,0x98,0xDA,0xD3,0xC7,0xDF,0x9C,0xDB,0xC7,0xD1,0xDC,0xA7,0xE5,0xA8,0xA7,0x93,0x9C,0x99,0x65,0x65,0x93,0xA0,0x64,0xA8,0x93,0x64,0x9A,0x93,0xAB,0x64,0xA6,0x9F,0x93,0xAB,0x68,0xA7,0x93,0x9D,0xA8,0x73,0xB1,0xE7,0xD3,0xDC,0xD9,0xA5,0xA5,0xD3,0xE0,0xA4,0xE8,0xD3,0xA4,0xDA,0xD3,0xEB,0xA4,0xE6,0xDF,0xD3,0xEB,0xA8,0xE7,0xD3,0xDD,0xE8,0xB3,0xF1,0xD2,0xDB,0xD8,0xA4,0xA4,0xD2,0xDF,0xA3,0xE7,0xD2,0xA3,0xD9,0xD2,0xEA,0xA3,0xE5,0xDE,0xD2,0xEA,0xA7,0xE6,0xD2,0xDC,0xE7,0xB2,0xF0,0xC7,0xC4,0x90,0x90,0xBE,0xCB,0x8F,0xD3,0xBE,0x8F,0xC5,0xBE,0xD6,0x8F,0xD1,0xCA,0xBE,0xD6,0x93,0xD2,0xBE,0xC8,0xD3,0x9E,0xDC,0xCD,0x99,0x99,0xC7,0xD4,0x98,0xDC,0xC7,0x98,0xCE,0xC7,0xDF,0x98,0xDA,0xD3,0xC7,0xDF,0x9C,0xDB,0xC7,0xD1,0xDC,0xA7,0xE5,0x96,0x96,0xC4,0xD1,0x95,0xD9,0xC4,0x95,0xCB,0xC4,0xDC,0x95,0xD7,0xD0,0xC4,0xDC,0x99,0xD8,0xC4,0xCE,0xD9,0xA4,0xE2,0x62,0x90,0x9D,0x61,0xA5,0x90,0x61,0x97,0x90,0xA8,0x61,0xA3,0x9C,0x90,0xA8,0x65,0xA4,0x90,0x9A,0xA5,0x70,0xAE,0x90,0x9D,0x61,0xA5,0x90,0x61,0x97,0x90,0xA8,0x61,0xA3,0x9C,0x90,0xA8,0x65,0xA4,0x90,0x9A,0xA5,0x70,0xAE,0xCB,0x8F,0xD3,0xBE,0x8F,0xC5,0xBE,0xD6,0x8F,0xD1,0xCA,0xBE,0xD6,0x93,0xD2,0xBE,0xC8,0xD3,0x9E,0xDC,0x9C,0xE0,0xCB,0x9C,0xD2,0xCB,0xE3,0x9C,0xDE,0xD7,0xCB,0xE3,0xA0,0xDF,0xCB,0xD5,0xE0,0xAB,0xE9,0xA4,0x8F,0x60,0x96,0x8F,0xA7,0x60,0xA2,0x9B,0x8F,0xA7,0x64,0xA3,0x8F,0x99,0xA4,0x6F,0xAD,0xD3,0xA4,0xDA,0xD3,0xEB,0xA4,0xE6,0xDF,0xD3,0xEB,0xA8,0xE7,0xD3,0xDD,0xE8,0xB3,0xF1,0x8F,0xC5,0xBE,0xD6,0x8F,0xD1,0xCA,0xBE,0xD6,0x93,0xD2,0xBE,0xC8,0xD3,0x9E,0xDC,0x96,0x8F,0xA7,0x60,0xA2,0x9B,0x8F,0xA7,0x64,0xA3,0x8F,0x99,0xA4,0x6F,0xAD,0xC5,0xDD,0x96,0xD8,0xD1,0xC5,0xDD,0x9A,0xD9,0xC5,0xCF,0xDA,0xA5,0xE3,0xD6,0x8F,0xD1,0xCA,0xBE,0xD6,0x93,0xD2,0xBE,0xC8,0xD3,0x9E,0xDC,0xA7,0xE9,0xE2,0xD6,0xEE,0xAB,0xEA,0xD6,0xE0,0xEB,0xB6,0xF4,0xA2,0x9B,0x8F,0xA7,0x64,0xA3,0x8F,0x99,0xA4,0x6F,0xAD,0xDD,0xD1,0xE9,0xA6,0xE5,0xD1,0xDB,0xE6,0xB1,0xEF,0xCA,0xE2,0x9F,0xDE,0xCA,0xD4,0xDF,0xAA,0xE8,0xD6,0x93,0xD2,0xBE,0xC8,0xD3,0x9E,0xDC,0xAB,0xEA,0xD6,0xE0,0xEB,0xB6,0xF4,0xA7,0x93,0x9D,0xA8,0x73,0xB1,0xD2,0xDC,0xE7,0xB2,0xF0,0xC8,0xD3,0x9E,0xDC,0xDD,0xA8,0xE6,0xB3,0xF1,0xBC]
input = [BitVec('input%s' %i, 8) for i in range(37)] 

s = Solver() 
k = 0 
for i in range(37) : 
    for j in range(i+1,37) :  
        s.add(input[i] + input[j] == arr[k])
        k += 1 
s.check() 
flag= ""
m = s.model() 
for i in range(37) : 
    flag += chr(int(str(m[input[i]]))) 
print flag 
```  

ChÃºng ta cÃ³ thá»ƒ dump giÃ¡ trá»‹ trong binary ra báº±ng cÃ¡ch bÃ´i Ä‘en táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ muá»‘n export (kÃ©o chuá»™t hoáº·c Shift + mÅ©i tÃªn xuá»‘ng). Sau Ä‘Ã³ trong IDA chá»n Edit -> Export data -> C unsinged char . Cho vÃ o visual code Ä‘á»ƒ fix láº¡i dáº¡ng Ä‘Ãºng chuáº©n python array .  

<a name="wu3">  
</a>  

# [Reverse] Tic Tac Toe   
BÃ i nÃ y lÃºc vÃ o sáº½ bá»‹ choÃ¡ng ngá»£p bá»Ÿi sá»‘ lÆ°á»£ng hÃ m cá»§a nÃ³. MÃ¬nh khÃ´ng biáº¿t Ä‘i tá»« Ä‘Ã¢u vá» Ä‘Ã¢u luÃ´n.  
ChÃºng ta cÃ³ thá»ƒ báº¯t Ä‘áº§u tá»« hÃ m ```start```.  

![](/re/ctf/InCTF/tictactoe/hinh1.PNG)  

NhÆ°ng tin mÃ¬nh Ä‘i nÃ³ sáº½ cháº³ng Ä‘i Ä‘áº¿n Ä‘Ã¢u cáº£ vÃ¬ chÆ°Æ¡ng trÃ¬nh ráº¥t lá»›n, pháº§n Ä‘áº§u nÃ³ thá»±c hiá»‡n ráº¥t nhiá»u cÃ´ng Ä‘oáº¡n , reverse nÃ³ lÃ  má»™t ná»— lá»±c lá»›n. NhÆ°ng cÃ³ cÃ¡ch ngáº¯n hÆ¡n thÃ¬ tá»™i gÃ¬ pháº£i Ä‘i con Ä‘Æ°á»ng dÃ i Ä‘Ãºng khÃ´ng ğŸ˜ğŸ˜ğŸ˜. CÃ³ má»™t kinh nghiá»‡m lÃ  trace theo nhá»¯ng hÃ m quan trá»ng.  
ÄÃ¢y lÃ  má»™t á»©ng dá»¥ng windows vá» trÃ² chÆ¡i tic-tac-toe. Khi Ä‘i má»™t cÆ¡ sá»‘ nÆ°á»›c thÃ¬ nÃ³ sáº½ in ra má»™t há»™p thoáº¡i.  

![](/re/ctf/InCTF/tictactoe/hinh2.PNG)  

VÃ  chÃºng ta hi vá»ng lÃ  khi ta Ä‘i theo má»™t quy luáº­t nÃ o Ä‘Ã³ thÃ¬ nÃ³ sáº½ in ra cho chÃºng ta flag. ÄÃ³ lÃ  má»™t viá»…n cáº£nh tÆ°Æ¡i Ä‘áº¹p. ğŸ˜ğŸ˜ğŸ˜ NhÆ°ng kháº£ nÄƒng Ä‘i bá»«a mÃ  ra flag lÃ  vÃ´ cÃ¹ng nhá». NÃªn Ä‘á»«ng hi vá»ng nhiá»u Ä‘á»ƒ rá»“i tháº¥t vá»ng.  
Ok Ä‘áº¿n Ä‘Ã¢y ta cÃ³ thá»ƒ nghÄ© tá»›i viá»‡c trace theo hÃ m in ra dialog box - ```MessageBoxW```. VÃ o cá»­a sá»• Imports vÃ  search tá»« mess :  

![](/re/ctf/InCTF/tictactoe/hinh3.PNG)  

KÃ­ch Ä‘Ãºp, chá»n vÃ o tá»« khÃ³a ```MessageBoxW``` rá»“i báº¥m X .  

![](/re/ctf/InCTF/tictactoe/hinh4.PNG)  

NÃ³ sáº½ hiá»‡n ra má»™t báº£ng lÃ  nhá»¯ng hÃ m Ä‘Ã£ gá»i hÃ m nÃ y. ChÃºng ta xem láº§n lÆ°á»£t tá»«ng cÃ¡i thÃ¬ tháº¥y háº§u háº¿t nÃ³ sáº½ in ra toÃ n máº¥y cÃ¡i linh tinh.ğŸ˜³ğŸ˜³ğŸ˜³ Duy chá»‰ cÃ³ má»™t cÃ¡i nÃ³ in ra **Lptext**.  

![](/re/ctf/InCTF/tictactoe/hinh5.PNG)  

CÃ³ nghÄ©a lÃ  cÃ¡i text áº¥y chÆ°a xÃ¡c Ä‘á»‹nh vÃ  thay Ä‘á»•i theo input user nháº­p vÃ o. ğŸ˜€ğŸ˜€ğŸ˜€ Äáº¿n Ä‘Ã¢y thÃ¬ cÅ©ng Ä‘oÃ¡n Ä‘Æ°á»£c 90% nÃ³ lÃ  flag rá»“i.  
F5 láº§n ná»¯a vÃ  ta Ä‘ang á»Ÿ má»™t hÃ m kiá»ƒu nhÆ° encode, decode gÃ¬ Ä‘Ã³ :  

![](/re/ctf/InCTF/tictactoe/hinh6.PNG)  

Sau khi encode, decode thÃ¬ nÃ³ sáº½ lÆ°u vÃ o Str rá»“i in ra mÃ n hÃ¬nh.  

![](/re/ctf/InCTF/tictactoe/hinh7.PNG)  

HÃ m nÃ y tÆ°Æ¡ng tá»± nhÆ° má»™t bÃ i keygen nÃ³ sáº½ checkinput cá»§a chÃºng ta xem cÃ³ há»£p lá»‡ khÃ´ng rá»“i quyáº¿t Ä‘á»‹nh in ra flag ko ? Input Ä‘á»™ dÃ i 16 . Tháº¥y quen thuá»™c khÃ´ng ? Ta sáº½ cÃ³ cÃ¡c phÆ°Æ¡ng trÃ¬nh vÃ  cÃ¡c biáº¿n nÃªn lÃ  cho háº¿t vÃ o Z3 Ä‘á»ƒ giáº£i thÃ´i. Äoáº¡n code cá»§a nÃ³ hÆ¡i dÃ i , nhÆ°ng cá»© tá»« tá»« add vÃ o cáº©n tháº­n lÃ  ok. CÃ³ má»™t máº¹o lÃ  copy y nguyÃªn code C trong IDA vÃ o visual code rá»“i sá»­a thÃ¬ sáº½ Ä‘á»¡ tá»‘n cÃ´ng hÆ¡n ğŸ˜‰ğŸ˜‰ğŸ˜‰.  

![](/re/ctf/InCTF/tictactoe/hinh8.PNG)  

Flag ra hÆ¡i lá»Ÿm nhÆ°ng chá»¯ Ä‘áº§u hoÃ n toÃ n Ä‘oÃ¡n Ä‘Æ°á»£c nÃªn cÅ©ng OK.  

# END
