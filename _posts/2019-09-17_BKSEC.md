---
layout : post 
title : BKSEC 2019  
--- 

# Má»Ÿ Ä‘áº§u  
ÄÃ¢y lÃ  kÃ¬ thi chá»n Ä‘á»™i tuyá»ƒn chuáº©n bá»‹ cho SVATTT 2019 sáº¯p diá»…n ra.Trong kÃ¬ thi mÃ¬nh feed quÃ¡, cáº£m tháº¥y trÃ¬nh pwn cÃ²n khÃ¡ cÃ¹i cáº§n rÃ¨n luyá»‡n thÃªm.  ğŸ˜¥ğŸ˜¥ğŸ˜¥ MÃ¬nh cÃ³ há»i hint anh **chung96vn** Ä‘á»ƒ lÃ m ná»‘t máº¥y bÃ i cÃ²n láº¡i vÃ  tá»•ng há»£p láº¡i. NÃ³i chung lÃ  cÅ©ng há»c Ä‘Æ°á»£c nhiá»u vÃ  cáº£m giÃ¡c cÃ³ Ä‘á»™ng lá»±c try hard hÆ¡n cho kÃ¬ thi sáº¯p tá»›i. ğŸ˜ğŸ˜ğŸ˜ Náº¿u khÃ´ng muá»‘n bá»‹ táº¡ch láº§n ná»¯a.   

# [**Play Around**](https://github.com/hacmao/hacmao.github.io/raw/master/Pwnable/BKSEC2019/playaround/play_around)    

ÄÃ¢y lÃ  bÃ i pwn Ä‘áº§u tiÃªn. Má»™t dáº¡ng bÃ i khÃ¡ quen thuá»™c vÃ  cÄƒn báº£n khi bÆ°á»›c vÃ o há»c pwnable.  

![](/Pwnable/BKSEC2019/playaround/hinh1.PNG)  

ChÃºng ta cÃ³ lá»—i trÃ n, stack thÃ¬ khÃ´ng cÃ³ canary nÃªn cÃ³ thá»ƒ trÃ n vá» Ä‘á»‹a chá»‰ trá»Ÿ vá» hÃ m ```vuln``` .   
CÃ´ng viá»‡c Ä‘áº§u tiÃªn lÃ  leak Ä‘Æ°á»£c libc. ChÃºng ta cÃ³ thá»ƒ ghi Ä‘Ã¨ lÃªn Ä‘á»‹a chá»‰ trá»Ÿ vá» Ä‘á»‹a chá»‰ plt cá»§a hÃ m printf vÃ  pass cho nÃ³ arguments lÃ  got cá»§a hÃ m ```printf```. NÃ³ sáº½ in ra Ä‘á»‹a chá»‰ cá»§a ```printf``` trong libc. Tá»« Ä‘Ã³ tÃ­nh toÃ¡n Ä‘Æ°á»£c Ä‘á»‹a chá»‰ cá»§a libc. Äá»“ng thá»i cáº§n trá»Ÿ láº¡i hÃ m ```main``` 1 láº§n ná»¯a.   
Cá»¥ thá»ƒ payload sáº½ cÃ³ dáº¡ng : 
```python 
payload = "a" * (0x80 + 8) + ret + pop_rdi + p64(0x601018) + p64(bin.sym['printf']) + ret + p64(bin.sym['vuln'])
``` 
Trong kÃ¬ thi khÃ´ng hiá»ƒu vÃ¬ lÃ­ do magic gÃ¬ mÃ  thay Ä‘á»‹a chá»‰ cá»§a ```got.printf``` vÃ o láº¡i khÃ´ng in Ä‘Æ°á»£c. Bá» vÃ o debug rÃµ rÃ ng nÃ³ cÃ³ gá»i hÃ m printf rá»“i ğŸ˜±ğŸ˜±ğŸ˜± Test thá»­ báº±ng cÃ¡c Ä‘á»‹a chá»‰ khÃ¡c thÃ¬ váº«n in ra Ä‘Æ°á»£c. Tháº¿ lÃ  mÃ¬nh thá»­ báº±ng Ä‘á»‹a chá»‰ ```got.setbuf``` thÃ¬ láº¡i Ä‘Æ°á»£c. Loay hoay chá»— nÃ y cÅ©ng tá»‘n kha khÃ¡ thá»i gian .  
CÃ´ng viá»‡c cÃ²n láº¡i chá»‰ lÃ  gá»i hÃ m ```system``` thÃ´i.  

# [**Death Note 1**](https://github.com/hacmao/hacmao.github.io/raw/master/Pwnable/BKSEC2019/deadnote1/Dead_Note_Lv1)  

ChÆ°Æ¡ng trÃ¬nh cÃ³ 2 hÃ m cÆ¡ báº£n ```add``` vÃ  ```del``` :  

![](/Pwnable/BKSEC2019/deadnote1/hinh1.PNG)   

![](/Pwnable/BKSEC2019/deadnote1/hinh2.PNG)  

![](/Pwnable/BKSEC2019/deadnote1/hinh3.PNG)   

HÃ m ```add``` cho phÃ©p chÃºng ta táº¡o má»™t vÃ¹ng heap size ```0x10``` vÃ  ghi khÃ´ng quÃ¡ 8 kÃ­ tá»± lÃªn Ä‘Ã³. Sau Ä‘Ã³ nÃ³ Ä‘Æ°á»£c check chá»‰ Ä‘Æ°á»£c ghi 0x3 kÃ­ tá»±.  
HÃ m ```del``` cho phÃ©p chÃºng phÃ©p chÃºng ta free má»™t con trá» vÃ  sau Ä‘Ã³ set láº¡i = 0.  

LÃºc Ä‘áº§u mÃ¬nh tÆ°á»Ÿng bÃ i nÃ y lÃ  ```heap``` cÆ¡ ğŸ˜‚ğŸ˜‚ğŸ˜‚ Sá»£ vl. Sau Ä‘Ã³ nhÃ¬n láº¡i cÃ³ lá»—i out of bound á»Ÿ hÃ m ```add```. ChÃºng ta cÃ³ thá»ƒ ghi Ä‘Ã¨ lÃªn GOT cá»§a 1 sá»‘ hÃ m trong Ä‘á»ƒ nÃ³ trá» vÃ o heap. Checksec thÃ¬ tháº¥y NX bá»‹ disable. Tá»©c lÃ  bÃ i nÃ y 90% lÃ  1 bÃ i shellcode. CÆ¡ mÃ  vÃ¬ nÃ³ filter cÃ³ 3 bytes nÃªn lÃ  Ä‘áº¿n Ä‘Ã¢y mÃ¬nh háº¿t Ã½ tÆ°á»Ÿng. Ä‚n hÃ nh suá»‘t máº¥y tiáº¿ng. VÃ¬ tá»« trÆ°á»›c Ä‘áº¿n giá» mÃ¬nh suy nghÄ© kiá»ƒu láº­p trÃ¬nh viÃªn, logic quÃ¡ nÃªn luÃ´n thá»«a nháº­n vÃ  lÃ m theo khuÃ´n khá»• cá»§a chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng bao giá» Ä‘áº·t cÃ¢u há»i lÃ  cÃ³ thá»ƒ bypass cÃ¡i nÃ y khÃ´ng ? CÃ³ thá»ƒ lÃ m khÃ¡c Ä‘i Ä‘Æ°á»£c khÃ´ng ? ğŸ˜ğŸ˜ğŸ˜ Pwn toÃ n lÃ  cÃº lá»«a , Ä‘Ã´i khi nÃªn nghÄ© khÃ¡c biá»‡t Ä‘i tÃ­ thÃ¬ má»›i ra Ä‘Æ°á»£c.  
Sau khi nháº­n hint tá»« ```tÃ¡c giáº£``` thÃ¬ mÃ¬nh mÃ¬nh Ä‘Ã£ bypass Ä‘Æ°á»£c hÃ m strlen Ä‘á»ƒ nÃ³ luÃ´n tráº£ vá» 1. Tá»©c lÃ  ta cÃ³ shellcode 8 bytes.  
Äáº¿n Ä‘Ã¢y mÃ¬nh láº¡i gáº·p pháº£i váº¥n Ä‘á» ğŸ˜°ğŸ˜°ğŸ˜° lÃ  tá»« trÆ°á»›c Ä‘áº¿n giá» toÃ n cop shellcode trÃªn máº¡ng vá» cháº¡y mÃ  khÃ´ng hiá»ƒu rÃµ báº£n cháº¥t. Cháº£ cÃ³ shellcode nÃ o mÃ  ngáº¯n Ä‘áº¿n Ä‘á»™ 8 bytes cáº£. Thá»i gian tiáº¿p theo idea cá»§a mÃ¬nh lÃ  ghi Ä‘Ã¨ lÃªn hÃ m free shellcode. MÃ¬nh chia nhá» shellcode thÃ nh cÃ¡c Ä‘oáº¡n rá»“i cuá»‘i má»—i Ä‘oáº¡n mÃ¬nh Ä‘áº·t lá»‡nh jmp. Tuy nhiÃªn mÃ¬nh láº¡i gáº·p váº¥n Ä‘á» vá» Ä‘Æ°a chuá»—i ```/bin/sh``` vÃ o binary . Láº¡i tiáº¿p tá»¥c feed ğŸ˜°ğŸ˜°ğŸ˜°  
Sau khi nháº­n tiáº¿p hint tá»« tÃ¡c giáº£ thÃ¬ mÃ¬nh viáº¿t láº¡i shellcode 8 bytes Ä‘á»ƒ ghi Ä‘Ã¨ lÃªn hÃ m ```atoi```. VÃ¬ hÃ m ```atoi``` Ä‘Æ°á»£c truyá»n vÃ o con trá» lÃ  ```nptr``` , cÃ³ thá»ƒ lÃ  chuá»—i ```/bin/sh``` luÃ´n.  ğŸ˜ğŸ˜ğŸ˜ :  

```c
0:  50                      push   rax
1:  5a                      pop    rdx
2:  50                      push   rax
3:  5e                      pop    rsi
4:  34 3b                   xor    al,0x3b
6:  0f 05                   syscall
```  
Qua Ä‘Ã¢y mÃ¬nh há»c Ä‘Æ°á»£c thÃªm kÄ© nÄƒng viáº¿t shellcode lÃ  táº­n dá»¥ng nhá»¯ng con trá» Ä‘áº§u vÃ o Ä‘á»ƒ giáº£m thiá»ƒu Ä‘á»™ dÃ i cá»§a shellcode. TrÆ°á»›c khi vÃ o hÃ m ```atoi``` ta cÃ³ ```$rax = 0``` cho nÃªn ta táº­n dá»¥ng nÃ³ Ä‘á»ƒ set $rdx, $rsi = 0. Rá»“i gá»i ```sysexecve``` lÃ  cÃ³ shell.  






